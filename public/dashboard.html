<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NV:RP Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --font-heading: 'Audiowide', sans-serif; --font-body: 'Rajdhani', sans-serif; --color-green-accent: #39FF14; --color-cyan-accent: #00FFFF;}
        body { font-family: var(--font-body); }
        h1, h2, h3, h4 { font-family: var(--font-heading); }
        .text-glow-green { text-shadow: 0 0 5px var(--color-green-accent), 0 0 10px var(--color-green-accent); }
        .status-select.processed { @apply bg-green-500/10 text-green-400 border-green-500/30; }
        .status-select.pending { @apply bg-yellow-500/10 text-yellow-400 border-yellow-500/30; }
        #sidebar { transition: transform 0.3s ease-in-out; }
        #main-content { transition: margin-left 0.3s ease-in-out; }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #overlay { opacity: 1; pointer-events: auto; }
        #overlay { transition: opacity 0.3s ease-in-out; }
        .pagination-btn:disabled { @apply bg-gray-600 cursor-not-allowed; }
        .online-player-name { @apply cursor-pointer text-gray-200 hover:text-cyan-400 transition-colors duration-150; }
        .raffle-modal {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        #raffle-names {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        #raffle-names::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        /* Custom scrollbar for sidebar */
        #sidebar nav::-webkit-scrollbar {
          width: 8px;
        }
        #sidebar nav::-webkit-scrollbar-track {
          background: #1f2937; /* bg-gray-800 */
        }
        #sidebar nav::-webkit-scrollbar-thumb {
          background: #4b5563; /* bg-gray-600 */
          border-radius: 4px;
        }
        #sidebar nav::-webkit-scrollbar-thumb:hover {
          background: #6b7280; /* bg-gray-500 */
        }
        .slot-machine-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            background: #111;
            border-radius: 10px;
            border: 2px solid var(--color-cyan-accent);
            overflow: hidden;
            padding: 0 20px;
        }
        .slot-reel {
            overflow: hidden;
            height: 100px;
            position: relative;
        }
        .slot-reel-inner {
            display: flex;
            flex-direction: column;
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .slot-item {
            height: 100px;
            line-height: 100px;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: #fff;
        }
        .winner .slot-item {
            color: var(--color-green-accent);
            text-shadow: 0 0 10px var(--color-green-accent);
        }
        .duplicate-ip {
            color: #FF5733; /* A reddish-orange color */
        }
    </style>
</head>
<body class="bg-gray-950 text-white min-h-screen">
    
    <aside id="sidebar" class="bg-gray-900 text-white w-64 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 z-50 flex flex-col">
        <div class="p-5 text-center flex-shrink-0">
            <h1 class="text-3xl font-black text-[var(--color-green-accent)]">NV:RP</h1>
            <p class="text-sm text-gray-400"><a href="faction.html">Admin Panel</a></p>
        </div>
        <nav class="mt-8 flex-1 overflow-y-auto">
            <a href="#dashboard" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg> Dashboard
            </a>
            <a href="#economy" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg> Economy
            </a>
            <a href="#events" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Events
            </a>
            <a href="#lookup" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Player Lookup
            </a>
            <a href="#all-players" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21v-1.157a6 6 0 01-1.12-3.843" /></svg> All Players
            </a>
            <a href="map.html" class="flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 10v-5.5m0 5.5v-5.5m0 0l6-3m-6 3l-6-3"/></svg> Live Map
            </a>
            <a href="faction.html" class="flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20" /></svg> Faction Record
            </a>
            <a href="general-log.html" class="flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> Payout Log
            </a>
            <a href="#players" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg> Applications
            </a>
            <a href="#donations" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1m0 1V4m0 2v1m0 0v1m-6 6h12M7 16a5 5 0 01-.894-9.902l-1.01-1.01A7 7 0 005 16m14 0a7 7 0 00-4.096-6.413l-1.01 1.01A5 5 0 0117 16"/></svg> Donations
            </a>
            <hr class="border-gray-700 my-4">
            <p class="px-5 text-xs uppercase text-gray-500 font-semibold">Game Logs</p>
            <a href="#admin-logs" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg> Admin Logs
            </a>
            <a href="#faction-logs" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20" /></svg> Faction Logs
            </a>
            <a href="#gang-logs" class="nav-link flex items-center py-3 px-5 text-lg text-gray-300 hover:bg-gray-800 hover:text-white">
                 <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.066 8.958L13 7.5a5.963 5.963 0 00-6 0l.934 1.458M12 21v-3.333M6.4 18.356l2.1-2.1M17.6 18.356l-2.1-2.1M3.644 12H7m10 0h3.356M15.5 5.644l-2.1 2.1M8.5 5.644l2.1 2.1M12 3a9 9 0 100 18 9 9 0 000-18z"/></svg> Gang Logs
            </a>
            <a href="#" id="logout-btn" class="flex items-center py-3 px-5 text-lg text-red-400 hover:bg-red-500/20 hover:text-red-300 mt-10">
                <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> Logout
            </a>
        </nav>
    </aside>

    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden opacity-0 pointer-events-none"></div>
    
    <div id="main-content" class="md:ml-64">
        <header class="md:hidden sticky top-0 bg-gray-900/80 backdrop-blur-sm p-4 flex justify-between items-center">
            <h1 class="text-xl font-black text-[var(--color-green-accent)]">NV:RP Admin</h1>
            <button id="menu-btn"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
        </header>

        <main class="p-6 md:p-12">
            <section id="dashboard" class="page-content">
                <h2 class="text-4xl font-extrabold text-glow-green mb-8">Dashboard</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><p class="text-sm text-gray-400">Total Applicants</p><p id="total-players" class="text-4xl font-bold">0</p></div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><p class="text-sm text-gray-400">Applicants Today</p><p id="players-today" class="text-4xl font-bold">0</p></div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><p class="text-sm text-gray-400">Total Donations</p><p id="total-donations" class="text-4xl font-bold">0</p></div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><p class="text-sm text-gray-400">Pending Donations</p><p id="pending-donations" class="text-4xl font-bold text-yellow-400">0</p></div>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Online Players (<span id="online-players-count">0</span>)</h3>
                        <div id="online-players-list" class="space-y-2 h-48 overflow-y-auto pr-2 text-lg"><p class="text-gray-400">Loading...</p></div>
                    </div>
                </div>
            </section>
            
            <section id="economy" class="page-content hidden">
                <h2 class="text-4xl font-extrabold text-glow-green mb-8">Economy Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <p class="text-sm text-gray-400">Live Total Circulation</p>
                        <p id="total-circulation" class="text-3xl lg:text-4xl font-bold text-green-400">₦0</p>
                        <p id="circulation-change" class="text-sm font-semibold mt-1">&nbsp;</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <p class="text-sm text-gray-400">Yesterday's Circulation</p>
                        <p id="yesterday-circulation" class="text-3xl lg:text-4xl font-bold text-gray-300">₦0</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <p class="text-sm text-gray-400">Total Server Asset Value</p>
                        <p id="server-asset-value" class="text-3xl lg:text-4xl font-bold text-cyan-400">₦0</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <p class="text-sm text-gray-400">Government Treasury</p>
                        <p id="government-treasury" class="text-3xl lg:text-4xl font-bold text-cyan-400">₦0</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg col-span-1 md:col-span-2 lg:col-span-1">
                        <p class="text-sm text-gray-400">Abolo AI Prediction (24h)</p>
                        <p id="gemini-prediction" class="text-3xl lg:text-4xl font-bold text-yellow-400">--%</p>
                        <button id="gemini-explanation-btn" class="text-xs text-gray-400 hover:text-white mt-1">Why?</button>
                    </div>
                </div>
                <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg mb-8">
                    <h3 class="text-xl font-bold mb-4">30-Day Circulation Trend</h3>
                    <canvas id="circulation-history-chart"></canvas>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><h3 class="text-xl font-bold mb-4">Wealth Distribution</h3><canvas id="wealth-chart"></canvas></div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg"><h3 class="text-xl font-bold mb-4">Top 10 Most Owned Vehicles</h3><canvas id="vehicles-chart"></canvas></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Wealthiest Players</h3>
                        <div id="wealthiest-players-list" class="space-y-3"></div>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Top Businesses</h3>
                        <div id="top-businesses-list" class="space-y-3"></div>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Faction Treasuries</h3>
                        <div id="faction-treasuries-list" class="space-y-3"></div>
                    </div>
                </div>
            </section>

            <section id="events" class="page-content hidden">
                <h2 class="text-4xl font-extrabold text-glow-green mb-8">Event Management</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg mb-8">
                            <h3 class="text-xl font-bold mb-4">Schedule Event</h3>
                            <form id="event-form">
                                <div class="mb-4">
                                    <label for="event-title" class="block text-sm font-semibold text-gray-400 mb-2">Event Title</label>
                                    <input type="text" id="event-title" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                </div>
                                <div class="mb-4">
                                    <label for="event-description" class="block text-sm font-semibold text-gray-400 mb-2">Description/Rules</label>
                                    <textarea id="event-description" rows="4" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none"></textarea>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label for="event-date" class="block text-sm font-semibold text-gray-400 mb-2">Event Date & Time</label>
                                        <input type="datetime-local" id="event-date" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                    </div>
                                    <div>
                                        <label for="announcement-date" class="block text-sm font-semibold text-gray-400 mb-2">Announcement Date & Time</label>
                                        <input type="datetime-local" id="announcement-date" class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-[var(--color-green-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-green-accent)]/80">Schedule</button>
                            </form>
                        </div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-4">Quick Tools</h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-semibold text-gray-300 mb-2">Quick Announcement</h4>
                                    <form id="quick-announcement-form" class="flex items-center gap-4">
                                        <input type="text" id="quick-announcement-input" placeholder="Announcement text" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                        <button type="submit" class="bg-[var(--color-cyan-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-cyan-accent)]/80 flex-shrink-0">Send</button>
                                    </form>
                                </div>
                                <hr class="border-gray-700">
                                <div>
                                    <h4 class="font-semibold text-gray-300 mb-2">Pay Winner</h4>
                                    <form id="pay-winner-form" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input type="text" id="pay-winner-name" placeholder="Player Name" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                        <input type="number" id="pay-winner-amount" placeholder="Amount" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                        <input type="text" id="pay-winner-reason" placeholder="Reason" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                                        <div class="md:col-span-3">
                                            <button type="submit" class="w-full bg-[var(--color-green-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-green-accent)]/80">Pay</button>
                                        </div>
                                    </form>
                                </div>
                                <hr class="border-gray-700">
                                <div>
                                    <h4 class="font-semibold text-gray-300 mb-2">Manual Event Log</h4>
                                    <form id="event-log-form">
                                        <textarea id="event-log-summary" rows="3" placeholder="Event summary" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none mb-4"></textarea>
                                        <button type="submit" class="w-full bg-[var(--color-green-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-green-accent)]/80">Save Log</button>
                                    </form>
                                </div>
                                <hr class="border-gray-700">
                                <div>
                                    <h4 class="font-semibold text-gray-300 mb-2">Participant Raffle</h4>
                                    <button id="raffle-btn" class="w-full bg-[var(--color-cyan-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-cyan-accent)]/80">Draw Random Player</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg mb-8">
                            <h3 class="text-xl font-bold mb-4">Scheduled Events</h3>
                            <div id="events-list" class="space-y-4"></div>
                        </div>
                        <div class="bg-gray-900/50 border border-gray-700 p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-4">Recent Event Logs</h3>
                            <div id="event-logs-list" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="lookup" class="page-content hidden">
                 <h2 class="text-4xl font-extrabold text-glow-green mb-8">Player In-Game Lookup</h2>
                 <form id="lookup-form" class="flex items-center gap-4 mb-8">
                     <input type="text" id="player-name-input" placeholder="Enter In-Game Name (e.g., FirstName_LastName)" required class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                     <button type="submit" class="bg-[var(--color-cyan-accent)] text-black px-6 py-3 rounded-md font-bold hover:bg-[var(--color-cyan-accent)]/80 flex-shrink-0">Search</button>
                 </form>
                 <div id="lookup-results" class="hidden"></div>
            </section>
            <section id="all-players" class="page-content hidden">
                <h2 class="text-4xl font-extrabold text-glow-green mb-8">All Players</h2>
                <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto">
                    <table class="w-full text-left min-w-[800px]">
                        <thead class="bg-gray-800">
                            <tr>
                                <th class="p-4 text-sm font-semibold text-green-400 uppercase">Username</th>
                                <th class="p-4 text-sm font-semibold text-green-400 uppercase">Level</th>
                                <th class="p-4 text-sm font-semibold text-green-400 uppercase">Hours</th>
                                <th class="p-4 text-sm font-semibold text-green-400 uppercase">Faction</th>
                                <th class="p-4 text-sm font-semibold text-green-400 uppercase">IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="all-players-tbody"></tbody>
                    </table>
                </div>
            </section>
            <section id="players" class="page-content hidden">
                 <h2 class="text-4xl font-extrabold text-glow-green mb-8">Player Applications</h2>
                 <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto"><table class="w-full text-left min-w-[800px]"><thead class="bg-gray-800"><tr><th class="p-4 text-sm font-semibold text-green-400 uppercase">Submitted</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Discord & In-Game</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Referral</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Answers</th></tr></thead><tbody id="players-tbody"></tbody></table></div>
            </section>
            <section id="donations" class="page-content hidden">
                 <h2 class="text-4xl font-extrabold text-glow-green mb-8">Donation History</h2>
                 <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto"><table class="w-full text-left min-w-[800px]"><thead class="bg-gray-800"><tr><th class="p-4 text-sm font-semibold text-green-400 uppercase">Date</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Discord & In-Game</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Tier & Amount</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Screenshot</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Status</th></tr></thead><tbody id="donations-tbody"></tbody></table></div>
            </section>
            <section id="admin-logs" class="page-content hidden">
                <h2 class="text-4xl font-extrabold text-glow-green mb-8">Admin Logs</h2>
                <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto">
                    <table class="w-full text-left min-w-[800px]"><thead class="bg-gray-800"><tr><th class="p-4 text-sm font-semibold text-green-400 uppercase">Date</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Description</th></tr></thead><tbody id="admin-logs-tbody"></tbody></table>
                </div>
                <div id="admin-logs-pagination" class="mt-6 flex justify-between items-center"></div>
            </section>
            <section id="faction-logs" class="page-content hidden">
                 <h2 class="text-4xl font-extrabold text-glow-green mb-8">Faction Logs</h2>
                <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto">
                    <table class="w-full text-left min-w-[800px]"><thead class="bg-gray-800"><tr><th class="p-4 text-sm font-semibold text-green-400 uppercase">Date</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Description</th></tr></thead><tbody id="faction-logs-tbody"></tbody></table>
                </div>
                <div id="faction-logs-pagination" class="mt-6 flex justify-between items-center"></div>
            </section>
            <section id="gang-logs" class="page-content hidden">
                 <h2 class="text-4xl font-extrabold text-glow-green mb-8">Gang Logs</h2>
                <div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6 overflow-x-auto">
                    <table class="w-full text-left min-w-[800px]"><thead class="bg-gray-800"><tr><th class="p-4 text-sm font-semibold text-green-400 uppercase">Date</th><th class="p-4 text-sm font-semibold text-green-400 uppercase">Description</th></tr></thead><tbody id="gang-logs-tbody"></tbody></table>
                </div>
                <div id="gang-logs-pagination" class="mt-6 flex justify-between items-center"></div>
            </section>
        </main>
    </div>
    
    <div id="raffle-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 raffle-modal">
        <div class="bg-gray-900 border-2 border-[var(--color-cyan-accent)] rounded-lg p-8 text-center w-full max-w-lg relative">
            <button id="close-raffle-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white">&times;</button>
            <h3 class="text-3xl font-bold mb-6 text-glow-green">Player Raffle</h3>
            <div id="raffle-slot-machine" class="slot-machine-container mb-6">
            </div>
            <p id="raffle-status" class="text-gray-400 min-h-[1.5rem]">Click "Draw" to start the raffle!</p>
        </div>
    </div>

    <div id="gemini-explanation-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-900 border-2 border-[var(--color-cyan-accent)] rounded-lg p-8 w-full max-w-lg relative">
            <button id="close-gemini-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-glow-green">Abolo AI Prediction Analysis</h3>
            <p id="gemini-explanation-text" class="text-gray-300"></p>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const backendUrl = "https://nigeria-vibe-backend.onrender.com";

        if (localStorage.getItem('isLoggedIn') !== 'true') { window.location.href = 'admin.html'; return; }
        document.getElementById('logout-btn').addEventListener('click', () => { localStorage.removeItem('isLoggedIn'); window.location.href = 'admin.html'; });
        
        const menuBtn = document.getElementById('menu-btn'), overlay = document.getElementById('overlay'), body = document.body;
        menuBtn.addEventListener('click', () => body.classList.toggle('sidebar-open'));
        overlay.addEventListener('click', () => body.classList.remove('sidebar-open'));
        
        const navLinks = document.querySelectorAll('.nav-link'), pages = document.querySelectorAll('.page-content');
        function showPage(hash) {
            const targetId = hash.substring(1) || 'dashboard';
            pages.forEach(p => p.classList.add('hidden'));
            document.getElementById(targetId)?.classList.remove('hidden');
            navLinks.forEach(link => link.classList.toggle('bg-gray-800', link.hash === hash));
            body.classList.remove('sidebar-open');
        }
        navLinks.forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); window.location.hash = link.hash; }); });
        window.addEventListener('hashchange', () => showPage(window.location.hash));
        
        function getFactionName(factionId) {
            switch (factionId) {
                case 1: return "Police";
                case 2: return "Medic/Fire";
                case 4: return "Government";
                case 5: return "Mechanic";
                case 16: return "EFCC";
                default: return "Civilian";
            }
        }

        const lookupPlayer = (playerName) => {
            if (!playerName) return;
            const playerNameInput = document.getElementById('player-name-input');
            const lookupForm = document.getElementById('lookup-form');
            playerNameInput.value = playerName;
            window.location.hash = '#lookup';
            if (typeof lookupForm.requestSubmit === 'function') {
                lookupForm.requestSubmit();
            } else {
                lookupForm.dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}));
            }
        };

        const fetchDashboardStats = async () => {
             try {
                const res = await fetch(`${backendUrl}/api/dashboard-stats`);
                const stats = await res.json();
                document.getElementById('total-players').textContent = stats.totalPlayers;
                document.getElementById('players-today').textContent = stats.playersToday;
                document.getElementById('total-donations').textContent = stats.totalDonations;
                document.getElementById('pending-donations').textContent = stats.pendingDonations;
            } catch (error) { console.error('Failed to fetch stats:', error); }
        };

        const fetchPlayers = async () => {
            const tbody = document.getElementById('players-tbody');
            try {
                const res = await fetch(`${backendUrl}/api/waitlist`);
                const players = await res.json();
                tbody.innerHTML = '';
                if (players.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="text-center p-8 text-gray-400">No applications found.</td></tr>'; return; }
                players.forEach(p => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-800';
                    row.innerHTML = `<td class="p-4 whitespace-nowrap">${new Date(p.date).toLocaleString()}</td><td class="p-4"><p class="font-bold">${p.discordUser}</p><p class="text-sm text-gray-400">${p.inGameName}</p></td><td class="p-4">${p.age}</td><td class="p-4 text-sm text-gray-300"><details><summary class="cursor-pointer hover:text-white">View Answers</summary><div class="mt-2 space-y-2 p-3 bg-gray-800 rounded"><p><strong class="text-gray-400">RP Definition:</strong> ${p.rpDefinition}</p><p><strong class="text-gray-400">Powergaming:</strong> ${p.powergaming}</p><p><strong class="text-gray-400">Backstory:</strong> ${p.backstory}</p></div></details></td>`;
                    tbody.appendChild(row);
                });
            } catch (error) { tbody.innerHTML = '<tr><td colspan="4" class="text-center p-8 text-red-400">Failed to load data.</td></tr>'; }
        };
        
        const donationsTbody = document.getElementById('donations-tbody');
        const fetchDonations = async () => {
            try {
                const response = await fetch(`${backendUrl}/api/donations`);
                const donations = await response.json();
                donationsTbody.innerHTML = '';
                if (donations.length === 0) { donationsTbody.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-gray-400">No donations found.</td></tr>'; return; }
                donations.forEach(d => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-800 hover:bg-gray-800/50';
                    row.innerHTML = `<td class="p-4 whitespace-nowrap">${new Date(d.date).toLocaleString()}</td><td class="p-4"><p class="font-bold">${d.discordUser}</p><p class="text-sm text-gray-400">${d.inGameName}</p></td><td class="p-4 font-semibold">${d.tier} <span class="text-[var(--color-cyan-accent)] font-bold">${d.price || ''}</span></td><td class="p-4"><a href="${backendUrl}${d.screenshotUrl}" target="_blank" class="text-[var(--color-cyan-accent)] hover:underline">View Image</a></td><td class="p-4"><select class="status-select w-full p-2 rounded-md border text-sm font-semibold bg-gray-700 ${d.status}" data-id="${d._id}"><option value="pending" ${d.status === 'pending' ? 'selected' : ''}>Pending</option><option value="processed" ${d.status === 'processed' ? 'selected' : ''}>Processed</option></select></td>`;
                    donationsTbody.appendChild(row);
                });
            } catch (error) { donationsTbody.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-red-400">Failed to load data.</td></tr>'; }
        };

        donationsTbody.addEventListener('change', async (e) => {
            if (e.target.classList.contains('status-select')) {
                const id = e.target.dataset.id;
                const status = e.target.value;
                try {
                    await fetch(`${backendUrl}/api/donations/${id}/status`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ status }) });
                    fetchDonations();
                } catch (error) { alert('Failed to update status.'); }
            }
        });

        const fetchAndDisplayLogs = async (logType, page = 1) => {
            const tbody = document.getElementById(`${logType}-logs-tbody`);
            const paginationContainer = document.getElementById(`${logType}-logs-pagination`);
            if (!tbody || !paginationContainer) return;
            tbody.innerHTML = `<tr><td colspan="2" class="text-center p-8 text-gray-400">Loading logs...</td></tr>`;
            try {
                const res = await fetch(`${backendUrl}/api/logs/${logType}?page=${page}`);
                const data = await res.json();
                tbody.innerHTML = '';
                if (!data.logs || data.logs.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="2" class="text-center p-8 text-gray-400">No logs found.</td></tr>`;
                    paginationContainer.innerHTML = '';
                    return;
                }
                data.logs.forEach(log => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-800';
                    row.innerHTML = `<td class="p-4 whitespace-nowrap text-gray-400">${new Date(log.date).toLocaleString()}</td><td class="p-4 text-white">${log.description}</td>`;
                    tbody.appendChild(row);
                });
                paginationContainer.innerHTML = `<span class="text-sm text-gray-400">Page ${data.currentPage} of ${data.totalPages}</span><div class="flex gap-2"><button class="pagination-btn bg-gray-700 px-4 py-2 rounded-md font-bold hover:bg-gray-600" data-log-type="${logType}" data-page="${data.currentPage - 1}" ${data.currentPage <= 1 ? 'disabled' : ''}>Previous</button><button class="pagination-btn bg-gray-700 px-4 py-2 rounded-md font-bold hover:bg-gray-600" data-log-type="${logType}" data-page="${data.currentPage + 1}" ${data.currentPage >= data.totalPages ? 'disabled' : ''}>Next</button></div>`;
            } catch (error) { tbody.innerHTML = `<tr><td colspan="2" class="text-center p-8 text-red-400">Failed to load logs.</td></tr>`; }
        };

        document.getElementById('main-content').addEventListener('click', (e) => {
            if (e.target.classList.contains('pagination-btn')) {
                const logType = e.target.dataset.logType;
                const page = parseInt(e.target.dataset.page);
                if (logType && page) { fetchAndDisplayLogs(logType, page); }
            }
        });

        const fetchOnlinePlayers = async () => {
            const listContainer = document.getElementById('online-players-list');
            const countContainer = document.getElementById('online-players-count');
            try {
                const response = await fetch(`${backendUrl}/api/online-players`);
                const players = await response.json();
                countContainer.textContent = players.length;
                listContainer.innerHTML = ''; 
                if (players.length === 0) { listContainer.innerHTML = '<p class="text-gray-400">No players are currently online.</p>'; return; }
                players.forEach(player => {
                    const nameEl = document.createElement('p');
                    nameEl.className = 'online-player-name';
                    nameEl.textContent = player.username;
                    nameEl.dataset.playername = player.username;
                    listContainer.appendChild(nameEl);
                });
            } catch (error) { console.error("Failed to fetch online players:", error); }
        };
        
        document.getElementById('online-players-list').addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('online-player-name')) { lookupPlayer(e.target.dataset.playername); }
        });

        let wealthChart, vehiclesChart, circulationHistoryChart;
        let geminiExplanation = '';

        const fetchAndDisplayEconomyStats = async () => {
        try {
            const response = await fetch(`${backendUrl}/api/economy-stats`);
            const data = await response.json();

            document.getElementById('total-circulation').textContent = `₦${data.totalCirculation.toLocaleString()}`;
            document.getElementById('yesterday-circulation').textContent = `₦${data.yesterdayCirculation.toLocaleString()}`;
            document.getElementById('server-asset-value').textContent = `₦${data.serverAssetValue.toLocaleString()}`;
            document.getElementById('government-treasury').textContent = `₦${data.governmentTreasury.toLocaleString()}`;

            const predictionResponse = await fetch(`${backendUrl}/api/gemini-analysis`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    circulationHistory: data.circulationHistory,
                    playerStats: data.playerStats // Pass the new playerStats object
                })
            });
            const predictionData = await predictionResponse.json();
            document.getElementById('gemini-prediction').textContent = `${predictionData.prediction}%`;
            geminiExplanation = predictionData.explanation;

            const changeElement = document.getElementById('circulation-change');
            if (data.yesterdayCirculation > 0) {
                const change = ((data.totalCirculation - data.yesterdayCirculation) / data.yesterdayCirculation) * 100;
                changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}% vs Yesterday`;
                changeElement.className = `text-sm font-semibold mt-1 ${change >= 0 ? 'text-green-400' : 'text-red-400'}`;
            } else {
                changeElement.textContent = 'Awaiting yesterday\'s data';
                changeElement.className = 'text-sm font-semibold mt-1 text-gray-400';
            }

            const historyCtx = document.getElementById('circulation-history-chart').getContext('2d');
            if(circulationHistoryChart) circulationHistoryChart.destroy();
            const reversedHistory = data.circulationHistory.slice().reverse();
            circulationHistoryChart = new Chart(historyCtx, { type: 'line', data: { labels: reversedHistory.map(d => new Date(d.snapshot_date).toLocaleDateString()), datasets: [{ label: 'Total Circulation', data: reversedHistory.map(d => d.total_circulation), borderColor: '#00FFFF', backgroundColor: 'rgba(0, 255, 255, 0.1)', fill: true, tension: 0.3 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#D1D5DB' } }, x: { ticks: { color: '#D1D5DB' } } } } });

            const wealthCtx = document.getElementById('wealth-chart').getContext('2d');
            if(wealthChart) wealthChart.destroy();
            wealthChart = new Chart(wealthCtx, { type: 'doughnut', data: { labels: data.wealthDistribution.map(d => d.wealthBracket), datasets: [{ data: data.wealthDistribution.map(d => d.playerCount), backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#EF4444'], borderColor: '#1f2937' }] }, options: { responsive: true, plugins: { legend: { position: 'top', labels: { color: '#D1D5DB' } } } } });

            const vehicleNames = { 411: 'Infernus', 560: 'Sultan', 476: 'Bullet', 559: 'Slamvan', 494: 'Hotring', 541: 'Cheetah', 487: 'Maverick', 562: 'Elegy', 460: 'NRG-500', 522: 'FCR-900' };
            const vehiclesCtx = document.getElementById('vehicles-chart').getContext('2d');
            if(vehiclesChart) vehiclesChart.destroy();
            vehiclesChart = new Chart(vehiclesCtx, { type: 'bar', data: { labels: data.topVehicles.map(v => vehicleNames[v.modelid] || `ID: ${v.modelid}`), datasets: [{ data: data.topVehicles.map(v => v.vehicleCount), backgroundColor: '#00FFFF' }] }, options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#D1D5DB' } }, x: { ticks: { color: '#D1D5DB' } } } } });

            const wealthiestPlayersList = document.getElementById('wealthiest-players-list');
            wealthiestPlayersList.innerHTML = '';
            data.wealthiestPlayers.forEach((player, index) => { wealthiestPlayersList.innerHTML += `<div class="flex justify-between items-center text-sm"><div><span class="text-gray-400 mr-2">${index + 1}.</span><span class="online-player-name font-semibold" data-playername="${player.username}">${player.username}</span></div><span class="font-bold text-green-400">₦${parseInt(player.total_wealth).toLocaleString()}</span></div>`; });
            
            const topBusinessesList = document.getElementById('top-businesses-list');
            topBusinessesList.innerHTML = '';
            data.topBusinesses.forEach((biz, index) => { topBusinessesList.innerHTML += `<div class="flex justify-between items-center text-sm"><div><span class="text-gray-400 mr-2">${index + 1}.</span><span class="font-semibold">${biz.biz_desc}</span></div><span class="font-bold text-yellow-400">₦${biz.cash.toLocaleString()}</span></div>`; });

            const factionTreasuriesList = document.getElementById('faction-treasuries-list');
            factionTreasuriesList.innerHTML = '';
            data.factionTreasuries.forEach((faction) => { factionTreasuriesList.innerHTML += `<div class="flex justify-between items-center text-sm"><span class="font-semibold">${faction.name}</span><span class="font-bold text-cyan-400">₦${faction.faction_treasury.toLocaleString()}</span></div>`; });

            wealthiestPlayersList.addEventListener('click', (e) => {
                if (e.target && e.target.classList.contains('online-player-name')) { lookupPlayer(e.target.dataset.playername); }
            });

        } catch (error) { console.error("Failed to fetch economy stats:", error); }
    };
        
        document.getElementById('gemini-explanation-btn').addEventListener('click', () => {
            document.getElementById('gemini-explanation-text').textContent = geminiExplanation;
            document.getElementById('gemini-explanation-modal').classList.remove('hidden');
        });

        document.getElementById('close-gemini-modal').addEventListener('click', () => {
            document.getElementById('gemini-explanation-modal').classList.add('hidden');
        });

        const lookupForm = document.getElementById('lookup-form');
        const lookupResultsContainer = document.getElementById('lookup-results');
        lookupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const playerName = document.getElementById('player-name-input').value.trim();
            if (!playerName) return;
            lookupResultsContainer.classList.remove('hidden');
            lookupResultsContainer.innerHTML = '<p class="text-center text-lg">Searching...</p>';
            try {
                const response = await fetch(`${backendUrl}/api/player/${playerName}`);
                const data = await response.json();
                if (!response.ok) { throw new Error(data.message || 'An error occurred'); }
                const s = data.stats;
                let vehiclesHtml = '<p class="text-gray-400">No vehicles found.</p>';
                if (data.vehicles && data.vehicles.length > 0) {
                    vehiclesHtml = `<div class="overflow-x-auto mt-2"><table class="w-full text-left"><thead class="bg-gray-800"><tr><th class="p-3 text-sm font-semibold text-green-400 uppercase">Model ID</th><th class="p-3 text-sm font-semibold text-green-400 uppercase">Tickets</th></tr></thead><tbody>${data.vehicles.map(v => `<tr class="border-b border-gray-800"><td class="p-3">${v.modelid}</td><td class="p-3">${v.tickets}</td></tr>`).join('')}</tbody></table></div>`;
                }
                let propertyLogsHtml = '<p class="text-gray-400">No property logs found for this player.</p>';
                if (data.propertyLogs && data.propertyLogs.length > 0) {
                    propertyLogsHtml = `<ul class="list-disc list-inside mt-2 space-y-1 text-gray-300 text-sm h-48 overflow-y-auto">${data.propertyLogs.map(log => `<li>${log.description}</li>`).join('')}</ul>`;
                }
                lookupResultsContainer.innerHTML = `<div class="bg-gray-900/50 border border-gray-700 rounded-lg p-6">
                    <h3 class="text-2xl font-bold text-white mb-6">Records for <span class="text-[var(--color-cyan-accent)]">${playerName}</span></h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="space-y-4">
                            <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Faction</p><p class="text-xl font-bold">${s.factionName} (Rank: ${s.factionrank})</p></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Level</p><p class="text-2xl font-bold">${s.level}</p></div>
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Hours Played</p><p class="text-2xl font-bold">${s.hours}</p></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Cash</p><p class="text-2xl font-bold text-green-400">₦${s.cash.toLocaleString()}</p></div>
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Bank</p><p class="text-2xl font-bold text-green-400">₦${s.bank.toLocaleString()}</p></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Fleeca Bank</p><p class="text-2xl font-bold text-cyan-400">₦${s.fleeca_bank.toLocaleString()}</p></div>
                                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-sm text-gray-400">Crimes</p><p class="text-2xl font-bold text-red-400">${s.crimes}</p></div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div><h4 class="text-xl font-bold text-white">Vehicles</h4>${vehiclesHtml}</div>
                            <div><h4 class="text-xl font-bold text-white">Property Logs</h4>${propertyLogsHtml}</div>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-700">
                        <h4 class="text-xl font-bold text-white mb-4">Admin Actions</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <input type="number" id="money-amount" placeholder="Amount" class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                            </div>
                            <div>
                                <button id="add-money-btn" class="w-full bg-green-500 text-white px-6 py-3 rounded-md font-bold hover:bg-green-600">Add Money</button>
                            </div>
                            <div>
                                <button id="deduct-money-btn" class="w-full bg-yellow-500 text-white px-6 py-3 rounded-md font-bold hover:bg-yellow-600">Deduct Money</button>
                            </div>
                            <div class="md:col-span-2">
                                <input type="text" id="ban-reason" placeholder="Ban Reason" class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 focus:ring-2 focus:ring-[var(--color-cyan-accent)] focus:outline-none">
                            </div>
                            <div>
                                <button id="ban-btn" class="w-full bg-red-500 text-white px-6 py-3 rounded-md font-bold hover:bg-red-600">Ban</button>
                            </div>
                        </div>
                    </div>
                </div>`;

                document.getElementById('add-money-btn').addEventListener('click', async () => {
                    const amount = document.getElementById('money-amount').value;
                    if (!amount) return alert('Please enter an amount.');
                    try {
                        await fetch(`${backendUrl}/api/player/${playerName}/add-money`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ amount: parseInt(amount) })
                        });
                        alert('Money added successfully!');
                        lookupPlayer(playerName);
                    } catch (error) {
                        alert('Failed to add money.');
                    }
                });

                document.getElementById('deduct-money-btn').addEventListener('click', async () => {
                    const amount = document.getElementById('money-amount').value;
                    if (!amount) return alert('Please enter an amount.');
                    try {
                        await fetch(`${backendUrl}/api/player/${playerName}/deduct-money`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ amount: parseInt(amount) })
                        });
                        alert('Money deducted successfully!');
                        lookupPlayer(playerName);
                    } catch (error) {
                        alert('Failed to deduct money.');
                    }
                });

                document.getElementById('ban-btn').addEventListener('click', async () => {
                    const reason = document.getElementById('ban-reason').value;
                    if (!reason) return alert('Please enter a reason for the ban.');
                    try {
                        await fetch(`${backendUrl}/api/player/${playerName}/ban`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ reason })
                        });
                        alert('Player banned successfully!');
                    } catch (error) {
                        alert('Failed to ban player.');
                    }
                });
            } catch (error) { lookupResultsContainer.innerHTML = `<p class="text-center text-lg text-red-400">${error.message}</p>`; }
        });
        
        const fetchAllPlayers = async () => {
            const tbody = document.getElementById('all-players-tbody');
            try {
                const [playersRes, duplicateIpsRes] = await Promise.all([
                    fetch(`${backendUrl}/api/all-players-list`),
                    fetch(`${backendUrl}/api/duplicate-ips`)
                ]);
                const players = await playersRes.json();
                const duplicateIps = await duplicateIpsRes.json();
                
                tbody.innerHTML = '';
                if (players.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-gray-400">No players found.</td></tr>';
                    return;
                }
                players.forEach(player => {
                    const row = document.createElement('tr');
                    const isDuplicate = duplicateIps.includes(player.ip);
                    row.className = `border-b border-gray-800 hover:bg-gray-800/50 cursor-pointer ${isDuplicate ? 'text-red-400' : ''}`;
                    row.dataset.playername = player.username;
                    row.innerHTML = `
                        <td class="p-4">${player.username}</td>
                        <td class="p-4">${player.level}</td>
                        <td class="p-4">${player.hours}</td>
                        <td class="p-4">${getFactionName(player.faction)}</td>
                        <td class="p-4">${player.ip}</td>
                    `;
                    row.addEventListener('click', () => {
                        lookupPlayer(player.username);
                    });
                    tbody.appendChild(row);
                });
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-red-400">Failed to load players.</td></tr>';
            }
        };


        const fetchEvents = async () => {
            const eventsList = document.getElementById('events-list');
            try {
                const response = await fetch(`${backendUrl}/api/events`);
                const events = await response.json();
                eventsList.innerHTML = '';
                if (events.length === 0) {
                    eventsList.innerHTML = '<p class="text-gray-400">No events scheduled.</p>';
                    return;
                }
                events.forEach(event => {
                    const eventEl = document.createElement('div');
                    eventEl.className = 'bg-gray-800 p-4 rounded-lg';
                    eventEl.innerHTML = `
                        <div class="flex justify-between items-center">
                            <p class="font-bold">${event.title}</p>
                            <button class="text-red-400 hover:text-red-300 delete-event-btn" data-id="${event.id}">&times;</button>
                        </div>
                        <p class="text-sm text-gray-400">${event.description}</p>
                        <p class="text-xs text-gray-500 mt-2">Event Date: ${new Date(event.event_date).toLocaleString()}</p>
                        <p class="text-xs text-gray-500">Announcement Date: ${new Date(event.announcement_date).toLocaleString()}</p>
                    `;
                    eventsList.appendChild(eventEl);
                });
            } catch (error) {
                console.error('Failed to fetch events:', error);
                eventsList.innerHTML = '<p class="text-red-400">Failed to load events.</p>';
            }
        };

        const fetchEventLogs = async () => {
            const eventLogsList = document.getElementById('event-logs-list');
            try {
                const response = await fetch(`${backendUrl}/api/event-logs`);
                const eventLogs = await response.json();
                eventLogsList.innerHTML = '';
                if (eventLogs.length === 0) {
                    eventLogsList.innerHTML = '<p class="text-gray-400">No event logs.</p>';
                    return;
                }
                eventLogs.forEach(log => {
                    const logEl = document.createElement('div');
                    logEl.className = 'bg-gray-800 p-4 rounded-lg';
                    logEl.innerHTML = `
                        <p class="text-sm text-gray-400">${log.summary}</p>
                        <p class="text-xs text-gray-500 mt-2">${new Date(log.date).toLocaleString()}</p>
                    `;
                    eventLogsList.appendChild(logEl);
                });
            } catch (error) {
                console.error('Failed to fetch event logs:', error);
                eventLogsList.innerHTML = '<p class="text-red-400">Failed to load event logs.</p>';
            }
        };

        document.getElementById('event-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('event-title').value;
            const description = document.getElementById('event-description').value;
            const event_date = document.getElementById('event-date').value;
            const announcement_date = document.getElementById('announcement-date').value;
            try {
                await fetch(`${backendUrl}/api/events`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, description, event_date, announcement_date })
                });
                fetchEvents();
            } catch (error) {
                alert('Failed to schedule event.');
            }
        });
        
        document.getElementById('events-list').addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-event-btn')) {
                const id = e.target.dataset.id;
                try {
                    await fetch(`${backendUrl}/api/events/${id}`, { method: 'DELETE' });
                    fetchEvents();
                } catch (error) {
                    alert('Failed to delete event.');
                }
            }
        });

        document.getElementById('quick-announcement-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = document.getElementById('quick-announcement-input').value;
            const embed = {
                title: '🌆 Event Announcement',
                description: text,
                color: 0x00BFFF
            };
            try {
                await fetch(`${backendUrl}/api/quick-announcement`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ embed })
                });
            } catch (error) {
                alert('Failed to send announcement.');
            }
        });
        
        document.getElementById('pay-winner-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const playerName = document.getElementById('pay-winner-name').value;
            const amount = document.getElementById('pay-winner-amount').value;
            const reason = document.getElementById('pay-winner-reason').value;
            try {
                await fetch(`${backendUrl}/api/pay-winner`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ playerName, amount, reason })
                });
                alert('Payment successful!');
            } catch (error) {
                alert('Failed to pay winner.');
            }
        });

        document.getElementById('event-log-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const summary = document.getElementById('event-log-summary').value;
            try {
                await fetch(`${backendUrl}/api/event-log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ summary })
                });
                fetchEventLogs();
            } catch (error) {
                alert('Failed to save event log.');
            }
        });
        
        // --- New Raffle Logic ---
        const raffleModal = document.getElementById('raffle-modal');
        const openRaffleBtn = document.getElementById('raffle-btn');
        const closeRaffleBtn = document.getElementById('close-raffle-modal');
        const raffleSlotMachine = document.getElementById('raffle-slot-machine');
        const raffleStatus = document.getElementById('raffle-status');
        let allPlayers = [];

        openRaffleBtn.addEventListener('click', async () => {
            raffleModal.classList.remove('hidden');
            raffleStatus.textContent = 'Fetching players...';
            try {
                const res = await fetch(`${backendUrl}/api/all-players`);
                allPlayers = await res.json();
                if(allPlayers.length < 1) {
                    raffleStatus.textContent = 'No players in database!';
                    return;
                }
                raffleStatus.textContent = 'Ready to draw!';
                startRaffle();
            } catch (e) {
                raffleStatus.textContent = 'Could not load players.';
            }
        });
        
        closeRaffleBtn.addEventListener('click', () => {
            raffleModal.classList.add('hidden');
        });
        
        async function startRaffle() {
            if (allPlayers.length === 0) return;
            
            raffleStatus.textContent = 'Drawing...';
            
            // Fetch the actual winner
            const winnerRes = await fetch(`${backendUrl}/api/random-player`);
            const winnerData = await winnerRes.json();
            const winner = winnerData.username;
            
            raffleSlotMachine.innerHTML = '';
            const reel = document.createElement('div');
            reel.className = 'slot-reel';
            const reelInner = document.createElement('div');
            reelInner.className = 'slot-reel-inner';

            const shuffledPlayers = [...allPlayers].sort(() => 0.5 - Math.random());
            const displayPlayers = shuffledPlayers.slice(0, 30);
            
            if (!displayPlayers.includes(winner)) {
                displayPlayers[Math.floor(Math.random() * displayPlayers.length)] = winner;
            }

            displayPlayers.forEach(player => {
                const item = document.createElement('div');
                item.className = 'slot-item';
                item.textContent = player;
                reelInner.appendChild(item);
            });
            
            reel.appendChild(reelInner);
            raffleSlotMachine.appendChild(reel);

            setTimeout(() => {
                const winnerIndex = displayPlayers.indexOf(winner);
                const itemHeight = 100;
                const offset = -winnerIndex * itemHeight;
                reelInner.style.transform = `translateY(${offset}px)`;

                setTimeout(() => {
                    raffleStatus.textContent = `Winner: ${winner}`;
                    reelInner.childNodes[winnerIndex].parentNode.classList.add('winner');
                }, 5000);
            }, 100);
        }

        const initialLoad = () => {
            showPage(window.location.hash || '#dashboard');
            fetchDashboardStats();
            fetchPlayers();
            fetchDonations();
            fetchAndDisplayLogs('admin');
            fetchAndDisplayLogs('faction');
            fetchAndDisplayLogs('gang');
            fetchOnlinePlayers();
            fetchAndDisplayEconomyStats();
            fetchEvents();
            fetchEventLogs();
            fetchAllPlayers();
            setInterval(fetchOnlinePlayers, 30000);
        };
        initialLoad();
    });
    </script>
</body>
</html>